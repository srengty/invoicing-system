import{n as P,c as p,C as Q,a as v,w,d as $,e as h,i as a,f as n,g as t,m as H,h as u,P as X,j as G,k as g,l as J,t as b,y as c,_ as W,p as Y,a2 as Z,X as ee,F as te}from"./app-bSMdDCtv.js";import{_ as le}from"./GuestLayout-D6vfYlh4.js";import{N as oe}from"./NavbarLayout-B9VpbdtL.js";import{s as ae}from"./index-DU88kvz-.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as V,a as y}from"./index-Ds-6aC4Y.js";import{s as ne}from"./index-BlOd25Hu.js";import{b as z,c as r,d as de}from"./index-BVmUdKqC.js";import{s as I}from"./index-CAdITkwZ.js";import{s as ie}from"./index-BRXjObJr.js";/* empty css                                                    */import"./index-VTpc7zfg.js";import"./index-CRC9bhxM.js";import"./index-t9nxt4Sg.js";var D={name:"Calendar",extends:ne,mounted:function(){console.warn("Deprecated since v4. Use DatePicker component instead.")}};const ue={class:"py-3 pb-0"},re={class:"create-invoice"},me={class:"flex justify-end items-center p-3 pt-0 mr-4"},ce={class:"flex gap-4"},pe={class:"p-3 grid grid-cols-1 md:grid-cols-4 gap-4 ml-4 mr-4"},fe={class:"flex items-center gap-2"},ve={class:"m-6"},be={class:"pl-2 pr-6"},_e={class:"total-container mt-4 flex justify-between"},ge={class:"font-bold"},Ve={class:"total-container mt-4 flex justify-between"},ye={class:"font-bold"},xe={class:"grand-total-container flex justify-between"},we={class:"font-bold"},Se={class:"terms mt-4"},ke={class:"buttons mt-4 flex justify-end"},Ue={__name:"Create",setup(T){const S=P(),F=p(()=>[{label:"",to:"/",icon:"pi pi-home"},{label:S.props.title||" Invoices",to:route("invoices.index")},{label:S.props.title||"Create Invoices",to:route("invoices.create")}]),{products:E,agreements:_,quotations:k,customers:N}=P().props,o=Q({invoice_no:"",agreement_no:"",quotation_no:"",customer_id:"",address:"",phone_number:"",terms:"",total_usd:null,exchange_rate:null,start_date:null,end_date:null,products:[]});v(null);const i=v([]),f=v(!1);v(_.filter(s=>s.status==="Open"));const m=v(null),L=p(()=>i.value.map(s=>({...s,subTotal:(s.price||0)*(s.quantity||1)}))),U=p(()=>L.value.reduce((s,e)=>s+(e.subTotal||0),0)),q=p(()=>o.total_usd&&o.total_usd>0?(U.value/o.total_usd).toFixed(4):"");w(()=>o.total_usd,s=>{s&&s>0&&(o.exchange_rate=q.value)});const j=p(()=>E.filter(s=>s.status==="approved")),A=p(()=>i.value.map((s,e)=>({...s,index:e+1,subTotal:(s.quantity||1)*(s.price||0)}))),R=p(()=>i.value.reduce((s,e)=>s+e.quantity*e.price,0));w(()=>o.quotation_no,s=>{var e;if(s){const l=k.find(d=>d.quotation_no===s);l&&(o.customer_id=l.customer_id||"",o.address=l.address||"",o.phone_number=l.phone_number||"",l.agreement?o.agreement_no=l.agreement.agreement_no:o.agreement_no="",((e=l.product_quotations)==null?void 0:e.length)>0&&(i.value=l.product_quotations.map(d=>({id:d.product.id,name:d.product.name,quantity:d.quantity,unit:d.product.unit,price:d.price,include_catalog:!1,pdf_url:null}))))}else o.customer_id="",o.address="",o.phone_number="",o.agreement_no="",i.value=[]}),w(()=>o.agreement_no,s=>{if(s){const e=_.find(l=>l.agreement_no===s);e&&(o.start_date=e.start_date||null,o.end_date=e.end_date||null)}});const O=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),M=()=>{if(m.value){const s=i.value.find(e=>e.id===m.value.id);s?s.quantity+=1:i.value.push({id:m.value.id,name:m.value.name,quantity:1,unit:m.value.unit,price:m.value.price,include_catalog:!1,pdf_url:null}),f.value=!1,m.value=null}},B=s=>{i.value=i.value.filter(e=>e.id!==s)},C=s=>{},K=()=>{o.reset(),i.value=[],window.location.href=route("invoices.index")},x=()=>{if(i.value.length===0){alert("Please add at least one product.");return}({...o.data(),start_date:o.start_date&&new Date(o.start_date).toISOString(),end_date:o.end_date&&new Date(o.end_date).toISOString(),products:i.value.map(s=>({id:s.id,quantity:s.quantity,price:s.price,include_catalog:s.include_catalog,acc_code:null,category_id:null,remark:null,pdf_url:s.pdf_url}))},o.products=i.value),o.total=R.value,o.post(route("invoices.store"),{preserveScroll:!0,onSuccess:()=>{o.reset(),i.value=[]},onError:s=>{console.error("Error creating invoice:",s)}})};return(s,e)=>(h(),$(te,null,[e[31]||(e[31]=a("meta",{name:"_token",content:"{{ csrf_token() }}"},null,-1)),n(t(H),{title:"Create Invoice"}),n(le,null,{default:u(()=>[n(oe),a("div",ue,[n(t(ae),{model:F.value,class:"border-none bg-transparent p-0"},{item:u(({item:l})=>[n(t(X),{href:l.to,class:"text-sm hover:text-primary flex items-start justify-center gap-1"},{default:u(()=>[l.icon?(h(),$("i",{key:0,class:J(l.icon)},null,2)):G("",!0),g(" "+b(l.label),1)]),_:2},1032,["href"])]),_:1},8,["model"])]),a("div",re,[a("div",me,[a("div",ce,[n(t(c),{label:"Add Product",icon:"pi pi-plus",class:"p-button-success",type:"button",onClick:e[0]||(e[0]=l=>f.value=!0),size:"small"}),n(t(c),{label:"Save Invoice",icon:"pi pi-check",class:"p-button-success",type:"button",onClick:x,size:"small"})])]),a("form",{onSubmit:W(x,["prevent"])},[a("div",pe,[a("div",null,[e[16]||(e[16]=a("label",{for:"invoice_no",class:"block text-sm font-medium"},"Invoice no",-1)),n(t(V),{id:"invoice_no",modelValue:t(o).invoice_no,"onUpdate:modelValue":e[1]||(e[1]=l=>t(o).invoice_no=l),placeholder:"Enter invoice no",required:"",class:"w-full md:w-72",size:"small"},null,8,["modelValue"])]),a("div",null,[e[17]||(e[17]=a("label",{for:"quotation_no",class:"block text-sm font-medium"},"Quotation No",-1)),n(t(y),{modelValue:t(o).quotation_no,"onUpdate:modelValue":e[2]||(e[2]=l=>t(o).quotation_no=l),options:t(k),optionLabel:"quotation_no",optionValue:"quotation_no",placeholder:"Select Quotation",class:"w-full md:w-72",size:"small",required:""},null,8,["modelValue","options"])]),a("div",null,[e[18]||(e[18]=a("label",{for:"agreement_no",class:"block text-sm font-medium"},"Agreement No",-1)),n(t(y),{modelValue:t(o).agreement_no,"onUpdate:modelValue":e[3]||(e[3]=l=>t(o).agreement_no=l),options:t(o).agreement_no||!t(o).quotation_no?t(_):t(_).filter(l=>l.status==="Open"),optionLabel:"agreement_no",optionValue:"agreement_no",placeholder:"Select Agreement",class:"w-full md:w-72",size:"small",required:""},null,8,["modelValue","options"])]),a("div",null,[e[20]||(e[20]=a("label",{for:"deposit_no",class:"block text-sm font-medium"},"Receipt No (for deposit)",-1)),a("div",fe,[n(t(V),{id:"deposit_no",modelValue:t(o).deposit_no,"onUpdate:modelValue":e[4]||(e[4]=l=>t(o).deposit_no=l),class:"w-1/2",placeholder:"Enter deposit number",required:"",size:"small"},null,8,["modelValue"]),n(t(c),{class:"grid md:w-1/2 gap-2 p-button-info",size:"small"},{default:u(()=>e[19]||(e[19]=[g(" Add Receipt")])),_:1})])]),a("div",null,[e[21]||(e[21]=a("label",{for:"customer_id",class:"block text-sm font-medium"},"Customer",-1)),n(t(y),{modelValue:t(o).customer_id,"onUpdate:modelValue":e[5]||(e[5]=l=>t(o).customer_id=l),options:t(N),optionLabel:"name",optionValue:"id",placeholder:"Select Customer",class:"w-full md:w-72",size:"small",required:""},null,8,["modelValue","options"])]),a("div",null,[e[22]||(e[22]=a("label",{for:"status",class:"block text-sm font-medium"},"Status",-1)),n(t(y),{modelValue:t(o).status,"onUpdate:modelValue":e[6]||(e[6]=l=>t(o).status=l),options:s.statusOptions,optionLabel:"label",optionValue:"value",placeholder:"Select Status",class:"w-full md:w-72",size:"small",required:""},null,8,["modelValue","options"])]),a("div",null,[e[23]||(e[23]=a("label",{for:"address",class:"block text-sm font-medium"},"Address",-1)),n(t(V),{id:"address",modelValue:t(o).address,"onUpdate:modelValue":e[7]||(e[7]=l=>t(o).address=l),class:"w-full md:w-72",size:"small",placeholder:"Enter address"},null,8,["modelValue"])]),a("div",null,[e[24]||(e[24]=a("label",{for:"phone",class:"block text-sm font-medium"},"Phone",-1)),n(t(V),{id:"phone",modelValue:t(o).phone,"onUpdate:modelValue":e[8]||(e[8]=l=>t(o).phone=l),class:"w-full md:w-72",size:"small",placeholder:"Enter phone number"},null,8,["modelValue"])]),a("div",null,[e[25]||(e[25]=a("label",{for:"start_date",class:"block text-sm font-medium"},"Start Date",-1)),n(t(D),{id:"start_date",modelValue:t(o).start_date,"onUpdate:modelValue":e[9]||(e[9]=l=>t(o).start_date=l),class:"w-full md:w-72",size:"small",placeholder:"Select start date",dateFormat:"yy-mm-dd",showTime:"",hourFormat:"24"},null,8,["modelValue"])]),a("div",null,[e[26]||(e[26]=a("label",{for:"end_date",class:"block text-sm font-medium"},"End Date",-1)),n(t(D),{id:"end_date",modelValue:t(o).end_date,"onUpdate:modelValue":e[10]||(e[10]=l=>t(o).end_date=l),class:"w-full md:w-72",size:"small",placeholder:"Select end date",dateFormat:"yy-mm-dd",showTime:"",hourFormat:"24"},null,8,["modelValue"])])])],32),a("div",ve,[n(t(z),{value:A.value,class:"p-datatable-striped",responsiveLayout:"scroll",size:"small"},{default:u(()=>[n(t(r),{field:"index",header:"No."},{body:u(l=>[g(b(l.index+1),1)]),_:1}),n(t(r),{field:"name",header:"Product"}),n(t(r),{field:"quantity",header:"Qty"},{body:u(l=>[n(t(I),{modelValue:l.data.quantity,"onUpdate:modelValue":d=>l.data.quantity=d,onInput:d=>C(l.data),class:"w-full",mode:"decimal",min:1},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),n(t(r),{field:"unit",header:"Unit"}),n(t(r),{field:"price",header:"Unit Price"},{body:u(l=>[n(t(I),{modelValue:l.data.price,"onUpdate:modelValue":d=>l.data.price=d,onInput:d=>C(l.data),class:"w-full",mode:"decimal",minFractionDigits:2,maxFractionDigits:2,min:1},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),n(t(r),{field:"subTotal",header:"Sub Total"}),n(t(r),{header:"Include Catalog"},{body:u(l=>[n(t(de),{modelValue:l.data.include_catalog,"onUpdate:modelValue":d=>l.data.include_catalog=d,binary:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(t(r),{header:"Action"},{body:u(l=>[n(t(c),{label:"Remove",icon:"pi pi-times",class:"p-button-text p-button-danger",onClick:d=>B(l.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),a("div",be,[a("div",_e,[e[27]||(e[27]=a("p",{class:"font-bold"},"Total KHR",-1)),a("p",ge," áŸ›"+b(U.value),1)]),a("div",Ve,[e[28]||(e[28]=a("p",{class:"font-bold"},"Total USD",-1)),a("p",ye,[Y(a("input",{type:"number","onUpdate:modelValue":e[11]||(e[11]=l=>t(o).total_usd=l),placeholder:"Enter USD",minFractionDigits:2,maxFractionDigits:2,class:"w-1/7 h-9 text-sm"},null,512),[[Z,t(o).total_usd,void 0,{number:!0}]])])]),a("div",xe,[e[29]||(e[29]=a("p",{class:"font-bold"},"Exchange rate",-1)),a("p",we,b(q.value),1)])]),a("div",Se,[e[30]||(e[30]=a("h3",{class:"text-lg"},"Terms and Conditions",-1)),n(t(ie),{modelValue:t(o).terms,"onUpdate:modelValue":e[12]||(e[12]=l=>t(o).terms=l),rows:"3",class:"w-full"},null,8,["modelValue"])]),a("div",ke,[n(t(c),{label:"Save Invoice",icon:"pi pi-check",class:"p-button-success shadow-md",onClick:x}),n(t(c),{label:"Cancel",class:"p-button-secondary ml-2 shadow-md",onClick:K})])]),n(t(ee),{visible:f.value,"onUpdate:visible":e[15]||(e[15]=l=>f.value=l),header:"Select Product",modal:!0,style:{width:"70vw"}},{footer:u(()=>[n(t(c),{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:e[14]||(e[14]=l=>f.value=!1)}),n(t(c),{label:"Add Product",icon:"pi pi-plus",class:"p-button-success",onClick:M,disabled:!m.value},null,8,["disabled"])]),default:u(()=>[n(t(z),{value:j.value,class:"p-datatable-striped",responsiveLayout:"scroll",size:"small",selectionMode:"single",selection:m.value,"onUpdate:selection":e[13]||(e[13]=l=>m.value=l),dataKey:"id"},{default:u(()=>[n(t(r),{field:"name",header:"Product Name"}),n(t(r),{field:"unit",header:"Unit"}),n(t(r),{field:"price",header:"Price"},{body:u(l=>[g(b(O(l.data.price)),1)]),_:1}),n(t(r),{field:"status",header:"Status"})]),_:1},8,["value","selection"])]),_:1},8,["visible"])])]),_:1})],64))}},Ae=se(Ue,[["__scopeId","data-v-d0e1731a"]]);export{Ae as default};
