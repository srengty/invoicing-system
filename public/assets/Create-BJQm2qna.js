import{n as $,c as p,a as f,C as Y,w as g,d as h,e as D,i as s,f as n,g as t,m as G,h as u,P as J,j as W,k as V,l as Z,t as b,y as c,_ as ee,p as te,a2 as le,X as oe,F as ae}from"./app-DZTdZYTv.js";import{_ as se}from"./GuestLayout-BfdKZXvL.js";import{N as ne}from"./NavbarLayout-Bz1XHzsh.js";import{s as de}from"./index-m66pCNzn.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as y,a as x}from"./index-BFVOh3Gg.js";import{s as ue}from"./index-DmsJMzp3.js";import{b as P,c as r,d as re}from"./index-Dm6_jG8z.js";import{s as I}from"./index-B9Lb2ArG.js";import{s as me}from"./index-B3UDJwyl.js";/* empty css                                                    */import"./index-Ch5aU8qY.js";import"./index-DRzkQ_aZ.js";import"./index-CHXn2h8A.js";var z={name:"Calendar",extends:ue,mounted:function(){console.warn("Deprecated since v4. Use DatePicker component instead.")}};const ce={class:"py-3 pb-0"},pe={class:"create-invoice"},fe={class:"flex justify-end items-center p-3 pt-0 mr-4"},ve={class:"flex gap-4"},be={class:"p-3 grid grid-cols-1 md:grid-cols-4 gap-4 ml-4 mr-4"},_e={class:"flex items-center gap-2"},ge={class:"m-6"},Ve={class:"pl-2 pr-6"},ye={class:"total-container mt-4 flex justify-between"},xe={class:"font-bold"},we={class:"total-container mt-4 flex justify-between"},Se={class:"font-bold"},ke={class:"grand-total-container flex justify-between"},Ue={class:"font-bold"},qe={class:"terms mt-4"},Ce={class:"buttons mt-4 flex justify-end"},$e={__name:"Create",setup(T){const S=$(),F=p(()=>[{label:"",to:"/",icon:"pi pi-home"},{label:S.props.title||" Invoices",to:route("invoices.index")},{label:S.props.title||"Create Invoices",to:route("invoices.create")}]),{products:N,agreements:_,quotations:k,customers:E}=$().props,A=f([{label:"Draft",value:"draft"},{label:"Approved",value:"approved"},{label:"Paid",value:"paid"},{label:"Cancelled",value:"cancelled"}]),o=Y({invoice_no:"",agreement_no:"",quotation_no:"",customer_id:"",address:"",phone_number:"",terms:"",total_usd:null,exchange_rate:null,start_date:null,end_date:null,status:"draft",products:[]});g(()=>o.status,a=>{if(a==="approved"){const e=new Date,l=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),H=String(e.getDate()).padStart(2,"0"),X=Math.floor(Math.random()*1e4).toString().padStart(4,"0");o.invoice_no=`INV-${l}${d}${H}-${X}`}else a==="draft"&&(o.invoice_no="DRAFT")}),f(null);const i=f([]),v=f(!1);f(_.filter(a=>a.status==="Open"));const m=f(null),L=p(()=>i.value.map(a=>({...a,subTotal:(a.price||0)*(a.quantity||1)}))),U=p(()=>L.value.reduce((a,e)=>a+(e.subTotal||0),0)),q=p(()=>o.total_usd&&o.total_usd>0?(U.value/o.total_usd).toFixed(4):"");g(()=>o.total_usd,a=>{a&&a>0&&(o.exchange_rate=q.value)});const j=p(()=>N.filter(a=>a.status==="approved")),M=p(()=>i.value.map((a,e)=>({...a,index:e+1,subTotal:(a.quantity||1)*(a.price||0)}))),R=p(()=>i.value.reduce((a,e)=>a+e.quantity*e.price,0));g(()=>o.quotation_no,a=>{var e;if(a){const l=k.find(d=>d.quotation_no===a);l&&(o.customer_id=l.customer_id||"",o.address=l.address||"",o.phone_number=l.phone_number||"",l.agreement?o.agreement_no=l.agreement.agreement_no:o.agreement_no="",((e=l.product_quotations)==null?void 0:e.length)>0&&(i.value=l.product_quotations.map(d=>({id:d.product.id,name:d.product.name,quantity:d.quantity,unit:d.product.unit,price:d.price,include_catalog:!1,pdf_url:null}))))}else o.customer_id="",o.address="",o.phone_number="",o.agreement_no="",i.value=[]}),g(()=>o.agreement_no,a=>{if(a){const e=_.find(l=>l.agreement_no===a);e&&(o.start_date=e.start_date||null,o.end_date=e.end_date||null)}});const O=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a),B=()=>{if(m.value){const a=i.value.find(e=>e.id===m.value.id);a?a.quantity+=1:i.value.push({id:m.value.id,name:m.value.name,quantity:1,unit:m.value.unit,price:m.value.price,include_catalog:!1,pdf_url:null}),v.value=!1,m.value=null}},K=a=>{i.value=i.value.filter(e=>e.id!==a)},C=a=>{},Q=()=>{o.reset(),i.value=[],window.location.href=route("invoices.index")},w=()=>{if(i.value.length===0){alert("Please add at least one product.");return}({...o.data(),start_date:o.start_date&&new Date(o.start_date).toISOString(),end_date:o.end_date&&new Date(o.end_date).toISOString(),products:i.value.map(a=>({id:a.id,quantity:a.quantity,price:a.price,include_catalog:a.include_catalog,acc_code:null,category_id:null,remark:null,pdf_url:a.pdf_url}))},o.products=i.value),o.total=R.value,o.post(route("invoices.store"),{preserveScroll:!0,onSuccess:()=>{o.reset(),i.value=[]},onError:a=>{console.error("Error creating invoice:",a)}})};return(a,e)=>(D(),h(ae,null,[e[31]||(e[31]=s("meta",{name:"_token",content:"{{ csrf_token() }}"},null,-1)),n(t(G),{title:"Create Invoice"}),n(se,null,{default:u(()=>[n(ne),s("div",ce,[n(t(de),{model:F.value,class:"border-none bg-transparent p-0"},{item:u(({item:l})=>[n(t(J),{href:l.to,class:"text-sm hover:text-primary flex items-start justify-center gap-1"},{default:u(()=>[l.icon?(D(),h("i",{key:0,class:Z(l.icon)},null,2)):W("",!0),V(" "+b(l.label),1)]),_:2},1032,["href"])]),_:1},8,["model"])]),s("div",pe,[s("div",fe,[s("div",ve,[n(t(c),{label:"Add Product",icon:"pi pi-plus",class:"p-button-success",type:"button",onClick:e[0]||(e[0]=l=>v.value=!0),size:"small"}),n(t(c),{label:"Save Invoice",icon:"pi pi-check",class:"p-button-success",type:"button",onClick:w,size:"small"})])]),s("form",{onSubmit:ee(w,["prevent"])},[s("div",be,[s("div",null,[e[16]||(e[16]=s("label",{for:"invoice_no",class:"block text-sm font-medium"},"Invoice no",-1)),n(t(y),{id:"invoice_no",modelValue:t(o).invoice_no,"onUpdate:modelValue":e[1]||(e[1]=l=>t(o).invoice_no=l),placeholder:"Enter invoice no",class:"w-full md:w-72",size:"small",readonly:t(o).status==="approved"},null,8,["modelValue","readonly"])]),s("div",null,[e[17]||(e[17]=s("label",{for:"quotation_no",class:"block text-sm font-medium"},"Quotation No",-1)),n(t(x),{modelValue:t(o).quotation_no,"onUpdate:modelValue":e[2]||(e[2]=l=>t(o).quotation_no=l),options:t(k),optionLabel:"quotation_no",optionValue:"quotation_no",placeholder:"Select Quotation",class:"w-full md:w-72",size:"small",required:""},null,8,["modelValue","options"])]),s("div",null,[e[18]||(e[18]=s("label",{for:"agreement_no",class:"block text-sm font-medium"},"Agreement No",-1)),n(t(x),{modelValue:t(o).agreement_no,"onUpdate:modelValue":e[3]||(e[3]=l=>t(o).agreement_no=l),options:t(o).agreement_no||!t(o).quotation_no?t(_):t(_).filter(l=>l.status==="Open"),optionLabel:"agreement_no",optionValue:"agreement_no",placeholder:"Select Agreement",class:"w-full md:w-72",size:"small",required:""},null,8,["modelValue","options"])]),s("div",null,[e[20]||(e[20]=s("label",{for:"deposit_no",class:"block text-sm font-medium"},"Receipt No (for deposit)",-1)),s("div",_e,[n(t(y),{id:"deposit_no",modelValue:t(o).deposit_no,"onUpdate:modelValue":e[4]||(e[4]=l=>t(o).deposit_no=l),class:"w-1/2",placeholder:"Enter deposit number",required:"",size:"small"},null,8,["modelValue"]),n(t(c),{class:"grid md:w-1/2 gap-2 p-button-info",size:"small"},{default:u(()=>e[19]||(e[19]=[V(" Add Receipt")])),_:1})])]),s("div",null,[e[21]||(e[21]=s("label",{for:"customer_id",class:"block text-sm font-medium"},"Customer",-1)),n(t(x),{modelValue:t(o).customer_id,"onUpdate:modelValue":e[5]||(e[5]=l=>t(o).customer_id=l),options:t(E),optionLabel:"name",optionValue:"id",placeholder:"Select Customer",class:"w-full md:w-72",size:"small",required:""},null,8,["modelValue","options"])]),s("div",null,[e[22]||(e[22]=s("label",{for:"status",class:"block text-sm font-medium"},"Status",-1)),n(t(x),{modelValue:t(o).status,"onUpdate:modelValue":e[6]||(e[6]=l=>t(o).status=l),options:A.value,optionLabel:"label",optionValue:"value",placeholder:"Select Status",class:"w-full md:w-72",size:"small",required:""},null,8,["modelValue","options"])]),s("div",null,[e[23]||(e[23]=s("label",{for:"address",class:"block text-sm font-medium"},"Address",-1)),n(t(y),{id:"address",modelValue:t(o).address,"onUpdate:modelValue":e[7]||(e[7]=l=>t(o).address=l),class:"w-full md:w-72",size:"small",placeholder:"Enter address"},null,8,["modelValue"])]),s("div",null,[e[24]||(e[24]=s("label",{for:"phone",class:"block text-sm font-medium"},"Phone",-1)),n(t(y),{id:"phone",modelValue:t(o).phone_number,"onUpdate:modelValue":e[8]||(e[8]=l=>t(o).phone_number=l),class:"w-full md:w-72",size:"small",placeholder:"Enter phone number"},null,8,["modelValue"])]),s("div",null,[e[25]||(e[25]=s("label",{for:"start_date",class:"block text-sm font-medium"},"Start Date",-1)),n(t(z),{id:"start_date",modelValue:t(o).start_date,"onUpdate:modelValue":e[9]||(e[9]=l=>t(o).start_date=l),class:"w-full md:w-72",size:"small",placeholder:"Select start date",dateFormat:"yy-mm-dd",showTime:"",hourFormat:"24"},null,8,["modelValue"])]),s("div",null,[e[26]||(e[26]=s("label",{for:"end_date",class:"block text-sm font-medium"},"End Date",-1)),n(t(z),{id:"end_date",modelValue:t(o).end_date,"onUpdate:modelValue":e[10]||(e[10]=l=>t(o).end_date=l),class:"w-full md:w-72",size:"small",placeholder:"Select end date",dateFormat:"yy-mm-dd",showTime:"",hourFormat:"24"},null,8,["modelValue"])])])],32),s("div",ge,[n(t(P),{value:M.value,class:"p-datatable-striped",responsiveLayout:"scroll",size:"small"},{default:u(()=>[n(t(r),{field:"index",header:"No."},{body:u(l=>[V(b(l.index+1),1)]),_:1}),n(t(r),{field:"name",header:"Product"}),n(t(r),{field:"quantity",header:"Qty"},{body:u(l=>[n(t(I),{modelValue:l.data.quantity,"onUpdate:modelValue":d=>l.data.quantity=d,onInput:d=>C(l.data),class:"w-full",mode:"decimal",min:1},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),n(t(r),{field:"unit",header:"Unit"}),n(t(r),{field:"price",header:"Unit Price"},{body:u(l=>[n(t(I),{modelValue:l.data.price,"onUpdate:modelValue":d=>l.data.price=d,onInput:d=>C(l.data),class:"w-full",mode:"decimal",minFractionDigits:2,maxFractionDigits:2,min:1},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),n(t(r),{field:"subTotal",header:"Sub Total"}),n(t(r),{header:"Include Catalog"},{body:u(l=>[n(t(re),{modelValue:l.data.include_catalog,"onUpdate:modelValue":d=>l.data.include_catalog=d,binary:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(t(r),{header:"Action"},{body:u(l=>[n(t(c),{label:"Remove",icon:"pi pi-times",class:"p-button-text p-button-danger",onClick:d=>K(l.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),s("div",Ve,[s("div",ye,[e[27]||(e[27]=s("p",{class:"font-bold"},"Total KHR",-1)),s("p",xe," ៛"+b(U.value),1)]),s("div",we,[e[28]||(e[28]=s("p",{class:"font-bold"},"Total USD",-1)),s("p",Se,[te(s("input",{type:"number","onUpdate:modelValue":e[11]||(e[11]=l=>t(o).total_usd=l),placeholder:"Enter USD",minFractionDigits:2,maxFractionDigits:2,class:"w-1/7 h-9 text-sm"},null,512),[[le,t(o).total_usd,void 0,{number:!0}]])])]),s("div",ke,[e[29]||(e[29]=s("p",{class:"font-bold"},"Exchange rate",-1)),s("p",Ue,b(q.value),1)])]),s("div",qe,[e[30]||(e[30]=s("h3",{class:"text-lg"},"Terms and Conditions",-1)),n(t(me),{modelValue:t(o).terms,"onUpdate:modelValue":e[12]||(e[12]=l=>t(o).terms=l),rows:"3",class:"w-full"},null,8,["modelValue"])]),s("div",Ce,[n(t(c),{label:"Save Invoice",icon:"pi pi-check",class:"p-button-success shadow-md",onClick:w}),n(t(c),{label:"Cancel",class:"p-button-secondary ml-2 shadow-md",onClick:Q})])]),n(t(oe),{visible:v.value,"onUpdate:visible":e[15]||(e[15]=l=>v.value=l),header:"Select Product",modal:!0,style:{width:"70vw"}},{footer:u(()=>[n(t(c),{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:e[14]||(e[14]=l=>v.value=!1)}),n(t(c),{label:"Add Product",icon:"pi pi-plus",class:"p-button-success",onClick:B,disabled:!m.value},null,8,["disabled"])]),default:u(()=>[n(t(P),{value:j.value,class:"p-datatable-striped",responsiveLayout:"scroll",size:"small",selectionMode:"single",selection:m.value,"onUpdate:selection":e[13]||(e[13]=l=>m.value=l),dataKey:"id"},{default:u(()=>[n(t(r),{field:"name",header:"Product Name"}),n(t(r),{field:"unit",header:"Unit"}),n(t(r),{field:"price",header:"Price"},{body:u(l=>[V(b(O(l.data.price)),1)]),_:1}),n(t(r),{field:"status",header:"Status"})]),_:1},8,["value","selection"])]),_:1},8,["visible"])])]),_:1})],64))}},Oe=ie($e,[["__scopeId","data-v-5e5880ee"]]);export{Oe as default};
